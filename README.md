# 마르코프 리워드 프로세스와 확률적 이동 시뮬레이션

## 프로젝트 소개

이 프로젝트는 미래의 상태는 오직 현재의 상태에 의해서만 결정되며 과거의 이동 경로는 영향을 주지 않는다는 **마르코프 성질**을 가진 격자 환경을 기반으로 합니다.
이러한 환경에서 **각 위치의 가치를 계산**하고 **확률적인 이동 과정을 시뮬레이션**하는 애플리케이션입니다.

### 주요 기능

- **가치 평가(마르코프 리워드 프로세스)**: 불확실한 이동 확률 속에서 각 위치가 목표 도달에 얼마나 유리한지(가치)를 계산합니다.
- **확률적 이동 시뮬레이션**: 정의된 확률 규칙에 따라 실제로 이동하는 경로를 추적하고 제한 시간 내 목표 도달 여부를 판단합니다.
- **결과 출력**: 텍스트 및 그래픽 인터페이스를 통해 위치별 가치와 이동 과정을 표현합니다.

## 프로젝트 구조

이 프로젝트는 핵심 로직을 담은 `core` 모듈을 중심으로 실행 환경에 따라 `app-cli`와 `app-gui`로 분리된 멀티 모듈 구조로 구성되어 있습니다.

### core 모듈

- **역할**: 마르코프 리워드 프로세스(MRP) 알고리즘, 지도 및 확률 데이터 모델, 핵심 계산 로직을 포함하는 `Kotlin` 모듈입니다. 외부 입출력 장치에 의존하지 않도록 구성했습니다.
- **테스트 환경**: JUnit 5, AssertJ

### app-cli 모듈

- **역할**: 텍스트를 기반으로 시뮬레이션의 진행 상황과 계산된 각 위치의 가치를 로그 형태로 콘솔에 출력하는 `Kotlin` 모듈입니다.
- **의존성**: `core` 모듈의 로직을 사용하여 시뮬레이션을 실행합니다.
- **테스트 환경**: JUnit 5, AssertJ

### app-gui 모듈

- **역할**: Java Swing을 활용하여 위치별 가치를 색상으로 시각화하고 에이전트의 이동 경로를 표현하는 `Java` 모듈입니다.
- **의존성**: `core 모듈의 로직을 사용하여 시뮬레이션을 실행합니다.
- **테스트 환경**: JUnit 4, AssertJ, AssertJ Swing

## `core` 모듈과 결과 출력 모듈 간 연결

`core` 모듈은 외부 환경(CLI, GUI)에 직접 의존하지 않기 위해 인터페이스(Interface)를 사용합니다.
`app-cli`와 `app-gui` 모듈은 인터페이스를 구현하여 환경에 맞게 출력합니다.

### 출력을 위한 인터페이스

- `MessageOutput`: 시스템 상태 메시지(성공, 에러)를 전달합니다.
- `ManualOutput`: 계산된 위치별 가치를 전달합니다.
- `SimulationOutput`: 특정 시점의 시뮬레이션을 전달합니다.

### app-cli에서 인터페이스 구현

- **단순 로그 출력**: 3가지 인터페이스 모두에 대해 추가적인 데이터 가공 없이 전달받은 정보를 즉시 콘솔로 출력합니다.

### app-gui에서 인터페이스 구현

- **비용 정규화(`ManualOutput`)**: 데이터를 받으면 즉시 출력하지 않고 비용 데이터의 최솟값과 최댓값을 산출합니다. 이를 기준으로 각 위치의 비용을 0~1 사이의 값으로 정규화하여 비용이 낮을수록
  초록색, 높을수록 붉은색을 띄도록 표현합니다.
- **임시 저장(`SimulationOutput`)**: `core`의 시뮬레이션 로직은 반복문을 통해 순식간에 모든 단계를 처리하고 결과를 배출합니다. GUI에서는 사용자가 이 과정을 단계별로 확인해야 하므로
  결과를 화면에 바로 그리지 않고 내부 큐(Queue)에 순서대로 저장합니다. 이후 사용자가 버튼을 누를 때마다 큐에서 데이터를 하나씩 꺼내어 화면을 갱신합니다.

## 실행 방법

### 입력 데이터 구성

입력 데이터는`core/src/main/resources` 경로의 파일을 수정하여 시뮬레이션 환경을 변경할 수 있습니다.
`map.txt`와 `probability.txt`로 두 개의 파일 입력으로 시작됩니다.

#### 지도 설정 (`map.txt`)

첫 줄은 `너비x높이`로 구성되며 아랫줄부터 지도를 그립니다.

- `s`: 출발지 (Start)
- `d`: 목적지 (Destination)
- `.`: 빈 공간

아래는 예시 지도입니다.

```text
3x3
s . .
. . .
. . d
```

#### 확률 설정 (`probability.txt`)

각 좌표별 이동 확률을 x,y:상,우,하,좌 순서로 입력합니다.

- **모든 좌표 정의**: `map.txt`에 정의된 **지도의 크기(모든 좌표)**에 해당하는 확률 정보가 빠짐없이 존재해야 합니다.
- **확률 합계**: 각 위치의 이동 확률은 양수여야 하며 총합은 **반드시 100**이어야 합니다.

```text
0,0:25,25,25,25
...
```

## 구현 할 기능 목록

### 출발지와 도착지가 안내된 지도를 입력받는 기능

- [x] 지도 파일을 읽어온다
- [x] 지도 크기를 읽어온다
- [x] 지도 크기가 양수가 아니라면 예외를 발생시킨다
- [x] 지도 크기로 입력받은 값이 정수가 아니라면 예외를 발생시킨다
- [x] 지도의 위치 정보(출발지 및 도착지 정보)를 읽어온다
- [x] 실제 지도 데이터가 선언된 크기와 일치하는지 않으면 예외를 발생시킨다
- [x] 지도가 출발지와 도착지를 포함하는지 않는다면 예외를 발생시킨다
- [x] 지도가 출발지와 도착지가 각 두개 이상 포함하면 예외를 발생시킨다
- [x] 지도에 유효하지 않은 값이 포함되었다면 예외를 발생시킨다
- [x] 출발지와 도착지가 안내된 올바른 지도 파일로부터 필요한 데이터를 읽어온다
- [x] 지도를 불러오는데 문제가 없다면 `[SUCCESS]`로 시작하는 성공 메시지를 출력한다
- [x] 지도를 읽어오는 기능에 문제가 있다면 `[ERROR]`로 시작하는 에러 메시지를 출력한다

### 위치 별 확률을 바탕으로 행동 매뉴얼을 만드는 기능

- [x] 위치 별 이동확률 정보 파일을 읽어온다
- [x] 위치 별 이동 확률을 저장한다
- [x] 지도 크기와 동일한 위치 개수가 아니라면 예외를 발생시킨다
- [x] 모든 위치에 대한 정보가 존재하는 지 않는다면 예외를 발생시킨다
- [x] 이동 확률이 유효한 범위가 아니라면 예외를 발생시킨다
- [x] 이동 확률의 총합이 유효 범위를 벗어나면 예외를 발생시킨다
- [x] 위치 별 이동 확률을 불러오는데 문제가 없다면 `[SUCCESS]`로 시작하는 성공 메시지를 출력한다
- [x] 위치 별 이동 확률을 읽어오는 기능에 문제가 있다면 `[ERROR]`로 시작하는 에러 메시지를 출력한다
- [x] 도착지까지의 거리(비용)를 계산한다
- [x] 모든 위치에 대해 거리를 계산한다
- [x] 거리를 바탕으로 행동 매뉴얼(Policy)을 만든다
    - [x] 위치 별 확률을 바탕으로 초기 메뉴얼을 만든다
    - [x] 이전보다 나아진 메뉴얼을 만든다
    - [x] 만들 수 있는 최선의 메뉴얼을 만든다
    - [x] 미래의 선택보다 현재의 선택을 중요시 하는 메뉴얼을 만든다
- [x] 계산한 행동 매뉴얼을 출력한다
- [x] 위치 별 이동확률 정보 파일을 읽어 최선의 행동 메뉴얼 결과를 출력한다

### 위치 별 이동 확률을 바탕으로 시뮬레이션하는 기능

- [x] 이동이 불가능한 방향으로의 입력(지도를 벗어나는 입력)은 제자리에 멈춘다
- [x] 시간 제한을 콘솔에서 입력받는다
- [x] 확률에 따라 위치를 이동한다
- [x] 제한 시간을 초과하면 시뮬레이션을 종료한다
- [x] 목적지에 도착하면 시뮬레이션을 종료한다
- [x] 이동할 때마다 결과(이동 및 시간)를 콘솔에 출력한다

### GUI로 결과를 보여주는 기능

- [x] 윈도우 타이틀을 요구사항에 맞게 출력한다
- [x] 지도를 불러오면 메시지를 출력한다
- [x] 위치 별 이동확률을 불려오면 메시지를 출력한다
- [x] 현재 위치와 도착 위치가 포함된 지도를 화면에 출력한다
- [x] 위치 별 이동 확률을 각 위치에 출력한다
- [x] 메뉴얼을 통해 각 위치별 가치를 표시한다
- [x] 지도를 바탕으로 초기 위치를 출력한다
- [x] 다음 버튼 클릭 시 이동된 방향을 출력한다
- [x] 현재 몇 번째 시뮬레이션인지 화면에 출력한다
- [x] 게임이 종료되면 메시지를 출력한다 
